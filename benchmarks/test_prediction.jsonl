{"instance_id": "astropy__astropy-12907", "model_name_or_path": "zeta-14b-7b-4b", "model_patch": "diff --git a/astropy/modeling/separable.py b/astropy/modeling/separable.py\n--- a/astropy/modeling/separable.py\n+++ b/astropy/modeling/separable.py\n@@ -45,6 +45,10 @@ def separability_matrix(models):\n         for model in models:\n             if isinstance(model, CompoundModel) and not model.separable:\n                 matrix = np.vstack([matrix] * len(model.models))\n+                # Recursively handle nested compound models to ensure correct\n+                # computation of the separability matrix.\n+                sub_matrix = separability_matrix(model.models)\n+                matrix[-len(sub_matrix):, -sub_matrix.shape[1]:] += sub_matrix\n\n     return matrix.sum(axis=0) > 0\n\n\n--- a/tests/test_separable.py\n+++ b/tests/test_separable.py\n@@ -24,6 +24,35 @@ def test_polynomial_shift_scale():\n     assert np.array_equal(separability_matrix([pshift]), [True])\n\n \n+def test_nested_compound_models():\n+    # Define nested compound models and check separability matrix correctness.\n+\n+    poly = m.Polynomial1D(2)\n+    shift_0 = m.Shift(1.5) & m.Scale(2.3)\n+    scale_1 = m.Scale(-4.7, name='scale') | m.Shift(98.6, name='shift')\n+\n+    # Create a nested compound model\n+    compound_model_nested = (poly + shift_0) * scale_1\n+\n+    expected_separability_matrix = np.array([\n+        [True, True],  # From Polynomial and Shift components of poly + shift\n+        [False, False] # Scale component introduces non-separable part.\n+    ])\n+\n+    actual_separability_matrix = separability_matrix([compound_model_nested])\n+\n+    assert (actual_separability_matrix == expected_separability_matrix).all()\n+\n+def test_deeply_nested_compound_models():\n+    poly2 = m.Polynomial1D(3)\n+    shift_0_poly2 = (m.Shift(-4.5) & m.Scale(-8.7)) | m.Polynomial1D(1, c0=96.4)\n+\n+    compound_model_nested_deeply = ((poly2 + shift_0_poly2) * scale_1) / poly\n+\n+    expected_separability_matrix = np.array([\n+        [True, True],  # From Polynomial and Shift components of poly + shift\n+        [False, False] # Scale component introduces non-separable part.\n+    ])\n+\n+    actual_separability_matrix = separability_matrix([compound_model_nested_deeply])\n+\n+    assert (actual_separability_matrix == expected_separability_matrix).all()"}
{"instance_id": "astropy__astropy-14182", "model_name_or_path": "zeta-14b-7b-4b", "model_patch": "diff --git a/astropy/table/_io.py b/astropy/table/_io.py\n--- a/astropy/table/_io.py\n+++ b/astropy/table/_io.py\n@@ -2384,7 +2384,9 @@ def _repr_latex_(self):\n     return latex_table(self)\n \n+def format_rest(include_header=True):\n     @wraps(format_rest)\n+    def wrapped_format_rest(table, include_header=include_header):\n         formatter = TableFormatter()\n         if isinstance(table.meta.get('comments'), dict) and 'caption' in table.meta['comments']:\n             caption = table.meta.comments['caption']\n@@ -2396,7 +2398,15 @@ def format_rest(include_header=True):\n                 column_widths = [max(len(c.name), len(str(c.info['width']))) for c in cols]\n         else:\n-        width_dict = dict(zip(cols, column_widths))\n+            width_dict = dict(zip(cols, column_widths))\n+\n+        if include_header:\n+            header_format_str = ' '.join('{{{name}:<{width}}}' \n+                                         .format(name=c.name, width=width) for c in cols)\n+            table_str += header_format_str.format(**table.colnames) + '\\n'\n+\n         # Add the rest of the rows\n-        format_str = '|'.join('{{:>{width}}}'.format(width=w) for w in column_widths)\n+        row_format_str = '|'.join('{{:>{width}}} |'.format(width=w) for w in column_widths)\n+        \n+        table_str += '\\n'\n         for row in table:\n             table_str += format(row, row_format_str) + '\\n'"}
